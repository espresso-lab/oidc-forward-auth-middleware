replicaCount: 1

# TODO: Deamon mode to have at least one pod per server?

image:
  repository: ghcr.io/espresso-lab/oidc-forward-auth-middleware
  pullPolicy: IfNotPresent
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}

securityContext: {}

service:
  type: ClusterIP
  port: 3000

resources: {}

config:
  sessionCookieName: x_forward_auth_session
  logLevel: info # debug, info, warn, error
  disableEnhancedSecurity: "false" # Enhanced security sets HTTP security headers and forces https

# Session store configuration (Redis/Valkey)
# When enabled, tokens are stored server-side in Redis/Valkey instead of browser cookies.
# This is required for OIDC providers with single-use refresh tokens (e.g., Kanidm)
# to avoid race conditions when multiple requests try to refresh the token simultaneously.
sessionStore:
  enabled: false
  # Use an external Redis/Valkey instance (overrides built-in valkey subchart)
  externalUrl: ""
  # Example: redis://valkey.default.svc.cluster.local:6379

# Valkey subchart configuration (only used when sessionStore.enabled=true and externalUrl is empty)
valkey:
  architecture: standalone
  auth:
    enabled: false
  primary:
    persistence:
      enabled: false
  replica:
    replicaCount: 0

oidcProviders:
  # - ingressHostname: example.com
  #   issuerUrl: https://id.example.com/oauth/app1
  #   clientId: app1
  #   clientSecret: mysecretpassword
  #   scopes: ["email", "profile"]
  #   existingSecret: oidc-config # Provide a secret with fields clientId, clientSecret
  #   audience: ["app1"]

extraEnvVars:
  # - name: EXAMPLE_ENV
  #   value: ABCD

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

volumes: []

volumeMounts: []

nodeSelector: {}

tolerations: []

affinity: {}
